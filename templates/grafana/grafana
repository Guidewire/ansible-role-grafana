server {
        listen   {{ grafana_http_port }}; ## listen for ipv4; this line is default and implied
        #listen   [::]:80 default ipv6only=on; ## listen for ipv6

        root /usr/share/nginx/html/grafana/src;
        index index.html index.htm;

        auth_basic      "Restricted";
        auth_basic_user_file  htpasswd.grafana;

        # Make site accessible from http://localhost/
        server_name {{ grafana_server_name }};

        location / {
                try_files $uri $uri/ /index.html;
        }

        location /graphite/ {
                proxy_pass         http://127.0.0.1:3080;
                proxy_redirect     off;
                proxy_set_header   Host             $host;
                proxy_set_header   X-Real-IP        $remote_addr;
                proxy_set_header   X-Forwarded-For  $remote_addr;

                client_max_body_size       10m;

                proxy_connect_timeout      90;
                proxy_send_timeout         180;
                proxy_read_timeout         180;
        }

        location /elasticsearch/ {
                proxy_pass         http://127.0.0.1:19201;
                proxy_redirect     off;
                proxy_set_header   Host             $host;
                proxy_set_header   X-Real-IP        $remote_addr;
                proxy_set_header   X-Forwarded-For  $remote_addr;

                client_max_body_size       10m;

                proxy_connect_timeout      90;
                proxy_send_timeout         180;
                proxy_read_timeout         180;
        }
}

server {
        listen   3080; ## listen for ipv4; this line is default and implied
        #listen   [::]:80 default ipv6only=on; ## listen for ipv6

        root /usr/share/nginx/html/grafana/src;
        index index.html index.htm;

        # Make site accessible from http://localhost/
        server_name {{ grafana_server_name }};
        error_log /var/log/nginx/graphite.log;

        location / {
                rewrite ^/graphite(.*)$ $1;
                proxy_pass         http://127.0.0.1:{{ graphite_http_port }};
                proxy_redirect     off;
                proxy_set_header   Host             $host;
                proxy_set_header   X-Real-IP        $remote_addr;
                proxy_set_header   X-Forwarded-For  $remote_addr;

                client_max_body_size       10m;

                proxy_connect_timeout      90;
                proxy_send_timeout         180;
                proxy_read_timeout         180;
        }
}
